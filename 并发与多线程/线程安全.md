# 究竟什么是线程安全

## 多线程带来的性能问题？

* 调度开销
  * 上下文切换：操作系统会按照一定的调度算法给每个线程分配时间片，进行调度时会引起上下文切换，挂起当前正在运行的线程并保存当前的状态。上下文切换带来的开销可能比执行线程本身带来的开销还要大。
  * 缓存失效：由于程序有大概率会再次访问刚才访问的数据，为了加速整个程序的运行，使用缓存。进行了线程调度，切换了线程，CPU执行不同的代码，原有的缓存就很可能失效了，需要重新缓存新的数据。

* 协作开销
  除了线程调度外，线程协作也有性能问题。因为线程间如果有共享数据，为了避免数据错乱，为了保证线程安全，就有可能禁止编译器和CPU对其进行重拍序等优化，有可能出于同步的目的，反复把内存中的数据flush到主存中，然后再从主存refresh到其他线程的工作内存中。